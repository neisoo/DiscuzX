<!--{block file}-->
<link href="source/plugin/zhikai_n5video/static/css/style.css" rel="stylesheet" />
<link href="source/plugin/zhikai_n5video/uikit/css/uikit.min.css" rel="stylesheet" />
<link href="source/plugin/zhikai_n5video/uikit/css/components/progress.css " rel="stylesheet" />
<link rel="stylesheet" href="source/plugin/zhikai_n5video/video-js/video-js.min.css">

<script type="text/javascript"src="source/plugin/zhikai_n5video/static/js/jquery.min.js"></script>
<script type="text/javascript" src="source/plugin/zhikai_n5video/static/js/jquery.shardupload.js"></script>
<script type="text/javascript" src="source/plugin/zhikai_n5video/uikit/js/uikit.min.js"></script>
<script type="text/javascript" src="source/plugin/zhikai_n5video/video-js/video.min.js"></script>';
<script type="text/javascript" src="source/plugin/zhikai_n5video/vtt.js/vtt.min.js"></script>';

<style>
::cue {
	background: none;
	color: #fff;
	text-shadow: 0 1px #000, 1px 0 #000, -1px 0 #000, 0 -1px #000;
	font-size: medium;
}
::cue(v[voice=hanhan]) {
	color: green;
}
::cue(.red) {
	color: red;
}
</style>

<div class="zhikai-player cl">
<video id="video_{$_G[tid]}" class="video-js vjs-default-skin vjs-big-play-centered vjs-fluid">
	<source src="{$attachInfo[video]}" type='video/mp4'>
	<p class="vjs-no-js">To view this video please enable JavaScript, and consider upgrading to a web browser that<a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a></p>
	<!--{if attachInfo['subtitle'] != null}-->
	<track kind="subtitles" src="{$attachInfo[subtitle]}" srclang="en" id="original" label="{lang zhikai_n5video:lang_068}" default></track>
	<!--{/if}--> 
	<!--{if $attachInfo['tsubtitle'] != null}-->
	<track kind="subtitles" src="{$attachInfo[tsubtitle]}" srclang="zh" id="translation" label="{lang zhikai_n5video:lang_069}"></track>
	<!--{/if}--> 
</video>
</div>

<script type="text/javascript">

var videoOptions = {
	poster: '{$attachInfo[cover]}',
	controls:true,
	fluid: true
};

var subtitleInit = false;
var player = videojs('video_{$_G[tid]}', videoOptions);

player.on("ready", function(){
	var origTrack = player.textTracks().getTrackById("original");
	var transTrack = player.textTracks().getTrackById("translation");

	origTrack.mode = 'showing';
	transTrack.mode = 'showing';
});

player.on("canplay", function(){
	
	if (!subtitleInit) {
		subtitleInit = true;

		var origTrack = player.textTracks().getTrackById("original");
		var transTrack = player.textTracks().getTrackById("translation");
		
		// 获取原文、译文和时间段。
		if (origTrack) {
			for (var i = 0, l = origTrack.cues.length; i < l; i++) {
				var cue = origTrack.cues[i];

				var dom = '<div class="n5sq_fbbt cl">' +
					'<b>' + (i + 1) + '/' + l + '</b> ' +
					cue.startTime + '-' + cue.endTime + ':<br/>' +
					cue.text;

				// 译文
				if (transTrack && transTrack.cues && transTrack.cues[i]) {
					dom += '<br/>' + transTrack.cues[i].text;
				}
				dom += '</div>';

				jq('#sutitle_list').append(dom);
			}
		}
		
		origTrack.mode = 'hidden';
		transTrack.mode = 'hidden';
	}
});

</script>

<div id="sutitle_list">
</div>
<!--{/block}-->