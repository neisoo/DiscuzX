{template common/header_ajax}
<div id="layer_lostpw_$loginhash">
	<h3 class="flb">
		<em id="returnmessage3_$loginhash">{lang zhikai_sms:langtsms016}</em>
		<span><a href="javascript:;" class="flbc" onclick="hideWindow('login')" title="{lang close}">{lang close}</a></span>
	</h3>
	<form method="post" autocomplete="off" id="retrievepswd" class="cl" action="plugin.php?id=zhikai_sms&motion=retrievepswd&retrievepswdsubmit=yes">
		<div class="c cl">
			<input type="hidden" name="formhash" value="{FORMHASH}" />
			<input type="hidden" name="motion" value="retrievepswd" />
			<input type="hidden" name="send_type" value="3" />
			<div class="rfm">
			<table>
				<tr>
					<th><span class="rq">*</span><label for="phone">{lang zhikai_sms:langtsms004}</label></th>
					<td><input type="text" id="phone" name="phone" class="px" tabindex="1" value="" autocomplete="off" size="15" maxlength="15" />
					</td>
				</tr>
			</table>
			</div>
			<div class="rfm">
			<table>
				<tr>
					<th><span class="rq">*</span><label for="code">{lang zhikai_sms:langtsms005}</label></th>
					<td><input type="text" id="code" name="code" class="px" tabindex="1" value="" autocomplete="off" size="6" maxlength="6" style="width:100px;"/></td>
					<td>&nbsp;&nbsp;&nbsp;<input class="pn" type="button" name="subcode" id="subcode" onclick="subsend(this);" style="width:100px;" value="{lang zhikai_sms:langtsms006}"></td>
				</tr>
			</table>
			</div>

			<div class="rfm">
				<table>
					<tr>
						<th><span class="rq">*</span><label for="newpasswd1">{lang zhikai_sms:langtsms018}</label></th>
						<td><input type="password" id="newpasswd1" name="newpasswd1" size="25" value="" tabindex="1" class="px" fwin="login"/></td>
					</tr>
				</table>
			</div>
			<div class="rfm">
				<table>
					<tr>
						<th><span class="rq">*</span><label for="newpasswd2">{lang zhikai_sms:langtsms019}</label></th>
						<td><input type="password" id="newpasswd2" name="newpasswd2" size="25" value="" tabindex="1" class="px" fwin="login"/></td>
					</tr>
				</table>
			</div>
			<div class="rfm mbw bw0">
				<table>
					<tr>
						<th></th>
						<td><button class="pn pnc" type="submit" name="retrievepswdsubmit" value="yes" tabindex="100" onclick="demand(this);return false;"><span>{lang submit}</span></button></td> <td> &nbsp;&nbsp;&nbsp;</td> 
						<td class="tipcol y"><a href="javascript:;" onclick="hideWindow('$_GET['handlekey']');showWindow('login', 'member.php?mod=logging&action=login&viewlostpw=1&retrieve=yes');">{lang zhikai_sms:langtsms017}</a></td>
					</tr>
				</table>
			</div>
		</div>
	</form>
</div>
<script type="text/javascript">
function demand(Obj){
	var formobj = zhikai(Obj.form);
	zhikai.ajax({
		type : 'POST',
		url:formobj.attr('action') + '&handlekey='+ formobj.attr('id'),
		data:formobj.serialize(),
		dataType : 'json'
	})
	.success(function(s) {
        console.log(s);
        if(s.succeed == 'ok'){
			hideWindow('login');
			showPrompt(null, null, '<div><i style="font-size:15px;">{lang zhikai_sms:langtsms020}</i></div>', 3000);
		}else if(s.error){
		    showPrompt(null, null, '<div><i style="font-size:15px;">'+ s.error +'</i></div>', 3000,"popuptext");
		}
	})
	.error(function() {
	   showPrompt(null, null, '<div><i style="font-size:15px;">{lang zhikai_sms:langtsms012}</i></div>', 3000,"popuptext");
	});
	return false;
}

function subsend(Obj){
	var countsec = "{$config['codetime']}"; 
	var phone = zhikai('#phone').val();
	zhikai.ajax({
		type : 'GET',
		url : 'plugin.php?id=zhikai_sms&motion=smssend&phone='+ phone +'&send_type=3&formhash={FORMHASH}',
		dataType : 'json'
	})
	.success(function(s) {
        console.log(s);
        if(s.succeed == 'ok'){
            zhikai('#subcode').attr('disabled',true);
		}else if(s.error){
		    showPrompt(null, null, '<div><i style="font-size:15px;">'+ s.error +'</i></div>', 3000,"popuptext");
			clearInterval(sendtime);
			return false;
		}
	})
	.error(function() {
	   showPrompt(null, null, '<div><i style="font-size:15px;">{lang zhikai_sms:langtsms012}</i></div>', 3000,"popuptext");
       return false;
	});

	sendtime = setInterval(function(){
		if (countsec == 0) {  
			zhikai(Obj).val('{lang zhikai_sms:langtsms013}'); 
			zhikai('#subcode').attr('disabled',false);
			countsec = "{$config['codetime']}";
			clearInterval(sendtime);
			return;
		} else {
            zhikai('#subcode').attr('disabled',true);
			zhikai(Obj).val('{lang zhikai_sms:langtsms014}' + countsec + '{lang zhikai_sms:langtsms015}'); 
			countsec--; 
		}
	},1000);
}
</script>
{template common/footer_ajax}